# 电话号码簿系统单元测试文档

## 测试概述

本项目为电话号码簿系统添加了全面的单元测试覆盖，包括以下测试类型：

### 1. 单元测试 (Unit Tests)
- **ContactServiceTest.java** - 业务逻辑层测试
- **ContactControllerTest.java** - 控制器层测试  
- **ContactRepositoryTest.java** - 数据访问层测试
- **ContactTest.java** - 实体类测试
- **ContactDTOTest.java** - 数据传输对象测试

### 2. 集成测试 (Integration Tests)
- **ContactServiceIntegrationTest.java** - 服务层集成测试
- **ContactControllerIntegrationTest.java** - 控制器集成测试
- **ContactRepositoryIntegrationTest.java** - 数据库集成测试

### 3. 异常处理测试
- **GlobalExceptionHandlerTest.java** - 全局异常处理测试

### 4. 应用启动测试
- **PhoneBookApplicationTest.java** - Spring Boot应用上下文测试

## 测试工具和框架

### 核心测试框架
- **JUnit 5** - 主要测试框架
- **Mockito** - Mock对象框架
- **AssertJ** - 断言库
- **Spring Boot Test** - Spring Boot测试支持

### 测试数据库
- **H2 Database** - 内存数据库，用于测试环境

### 测试覆盖率
- **JaCoCo** - 代码覆盖率工具
- 目标覆盖率：80%以上

## 测试分类

### 1. 控制器层测试 (Controller Tests)
```java
@WebMvcTest(ContactController.class)
class ContactControllerTest {
    // 测试REST API端点
    // 测试请求参数验证
    // 测试响应格式
    // 测试异常处理
}
```

**测试场景：**
- ✅ 创建联系人 (POST /api/contacts)
- ✅ 获取所有联系人 (GET /api/contacts)
- ✅ 根据ID获取联系人 (GET /api/contacts/{id})
- ✅ 更新联系人 (PUT /api/contacts/{id})
- ✅ 删除联系人 (DELETE /api/contacts/{id})
- ✅ 搜索联系人 (GET /api/contacts/search)
- ✅ 参数验证失败处理
- ✅ 资源不存在异常处理

### 2. 服务层测试 (Service Tests)
```java
@ExtendWith(MockitoExtension.class)
class ContactServiceTest {
    // 测试业务逻辑
    // 测试数据转换
    // 测试异常场景
}
```

**测试场景：**
- ✅ 创建联系人业务逻辑
- ✅ 查询联系人业务逻辑
- ✅ 更新联系人业务逻辑
- ✅ 删除联系人业务逻辑
- ✅ 搜索功能业务逻辑
- ✅ 数据验证逻辑
- ✅ 异常处理逻辑

### 3. 数据访问层测试 (Repository Tests)
```java
@DataJpaTest
class ContactRepositoryTest {
    // 测试数据库操作
    // 测试自定义查询
    // 测试数据完整性
}
```

**测试场景：**
- ✅ 基本CRUD操作
- ✅ 自定义查询方法
- ✅ 分页和排序
- ✅ 数据约束验证
- ✅ 事务处理

### 4. 实体类测试 (Entity Tests)
```java
class ContactTest {
    // 测试实体属性
    // 测试验证注解
    // 测试equals/hashCode
}
```

**测试场景：**
- ✅ 属性getter/setter
- ✅ 数据验证注解
- ✅ equals和hashCode方法
- ✅ toString方法

## 测试配置

### 测试配置文件
- **application-test.yml** - 测试环境配置
- **TestConfig.java** - 测试专用配置类

### 测试工具类
- **TestDataFactory.java** - 测试数据工厂类

## 运行测试

### 1. 运行所有单元测试
```bash
mvn test
```

### 2. 运行集成测试
```bash
mvn integration-test
```

### 3. 生成测试覆盖率报告
```bash
mvn jacoco:report
```

### 4. 使用测试脚本
```bash
./run-tests.sh
```

## 测试覆盖率目标

| 层级 | 目标覆盖率 | 当前状态 |
|------|------------|----------|
| 控制器层 | 90%+ | ✅ |
| 服务层 | 95%+ | ✅ |
| 数据访问层 | 85%+ | ✅ |
| 实体类 | 80%+ | ✅ |
| 整体项目 | 80%+ | ✅ |

## 测试最佳实践

### 1. 测试命名规范
- 使用描述性的测试方法名
- 格式：`should_ExpectedBehavior_When_StateUnderTest`

### 2. 测试结构
- **Given** - 准备测试数据
- **When** - 执行被测试的方法
- **Then** - 验证结果

### 3. Mock使用原则
- 只Mock外部依赖
- 避免过度Mock
- 使用@MockBean进行Spring集成测试

### 4. 测试数据管理
- 使用TestDataFactory创建测试数据
- 每个测试方法独立的测试数据
- 测试后清理数据

## 持续集成

### Maven插件配置
- **maven-surefire-plugin** - 单元测试执行
- **maven-failsafe-plugin** - 集成测试执行
- **jacoco-maven-plugin** - 代码覆盖率分析

### 测试报告
- **Surefire报告**: `target/surefire-reports/`
- **JaCoCo报告**: `target/site/jacoco/index.html`

## 测试维护

### 定期检查
- 每次代码提交前运行测试
- 定期检查测试覆盖率
- 及时更新过时的测试

### 测试重构
- 消除重复的测试代码
- 提取公共的测试工具方法
- 保持测试代码的可读性

## 总结

本测试套件为电话号码簿系统提供了全面的测试覆盖，确保：

1. **功能正确性** - 所有业务功能都有对应测试
2. **代码质量** - 高测试覆盖率保证代码质量
3. **回归防护** - 防止新功能破坏现有功能
4. **文档作用** - 测试代码作为功能文档
5. **重构支持** - 安全地进行代码重构

通过这套完整的测试体系，可以确保电话号码簿系统的稳定性和可靠性。