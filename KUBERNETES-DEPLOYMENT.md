# ğŸš€ ç”µè¯å·ç ç°¿ç³»ç»Ÿ - Kubernetes å®Œæ•´éƒ¨ç½²æ–¹æ¡ˆ

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å·²å®Œæˆä»ä¼ ç»ŸSpring Bootåº”ç”¨åˆ°äº‘åŸç”ŸKuberneteséƒ¨ç½²çš„å®Œæ•´è½¬æ¢ï¼Œæä¾›äº†ä¼ä¸šçº§çš„å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆã€‚

## ğŸ—ï¸ æŠ€æœ¯æ ˆ

- **åç«¯æ¡†æ¶**: Spring Boot 2.7.14 (Java 8å…¼å®¹)
- **æ•°æ®åº“**: MySQL 8.0 (å¤–éƒ¨æ‰˜ç®¡)
- **å®¹å™¨åŒ–**: Docker
- **ç¼–æ’å¹³å°**: Kubernetes
- **æœåŠ¡ç½‘æ ¼**: Ingress Controller
- **ç›‘æ§**: Prometheus + Actuator
- **æ„å»ºå·¥å…·**: Maven

## ğŸ“ é¡¹ç›®ç»“æ„

```
phonebook/
â”œâ”€â”€ src/                          # Spring Boot æºä»£ç 
â”œâ”€â”€ k8s/                          # Kubernetes é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ namespace.yaml            # å‘½åç©ºé—´
â”‚   â”œâ”€â”€ configmap.yaml            # åº”ç”¨é…ç½®
â”‚   â”œâ”€â”€ secret.yaml               # æ•æ„Ÿä¿¡æ¯
â”‚   â”œâ”€â”€ deployment.yaml           # åº”ç”¨éƒ¨ç½²
â”‚   â”œâ”€â”€ service.yaml              # æœåŠ¡å‘ç°
â”‚   â”œâ”€â”€ ingress.yaml              # å¤–éƒ¨è®¿é—®
â”‚   â”œâ”€â”€ hpa.yaml                  # è‡ªåŠ¨æ‰©ç¼©å®¹
â”‚   â”œâ”€â”€ pdb.yaml                  # Podä¸­æ–­é¢„ç®—
â”‚   â”œâ”€â”€ networkpolicy.yaml        # ç½‘ç»œå®‰å…¨ç­–ç•¥
â”‚   â”œâ”€â”€ rbac.yaml                 # æƒé™ç®¡ç†
â”‚   â”œâ”€â”€ kustomization.yaml        # èµ„æºç®¡ç†
â”‚   â””â”€â”€ monitoring/
â”‚       â””â”€â”€ servicemonitor.yaml   # Prometheusç›‘æ§
â”œâ”€â”€ build-and-deploy.sh           # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ k8s-README.md                 # è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ Dockerfile                    # å®¹å™¨é•œåƒæ„å»º
â””â”€â”€ pom.xml                       # Mavené…ç½®
```

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. é«˜å¯ç”¨æ€§
- **å¤šå‰¯æœ¬éƒ¨ç½²**: é»˜è®¤3ä¸ªPodå‰¯æœ¬
- **æ»šåŠ¨æ›´æ–°**: é›¶åœæœºæ—¶é—´éƒ¨ç½²
- **å¥åº·æ£€æŸ¥**: å®Œæ•´çš„å­˜æ´»ã€å°±ç»ªå’Œå¯åŠ¨æ¢é’ˆ
- **Podä¸­æ–­é¢„ç®—**: ä¿è¯æœ€å°å¯ç”¨å®ä¾‹æ•°

### 2. è‡ªåŠ¨æ‰©ç¼©å®¹
- **HPAé…ç½®**: åŸºäºCPUå’Œå†…å­˜ä½¿ç”¨ç‡è‡ªåŠ¨æ‰©ç¼©å®¹
- **èµ„æºé™åˆ¶**: åˆç†çš„CPUå’Œå†…å­˜é…é¢
- **æ‰©å®¹ç­–ç•¥**: æ™ºèƒ½çš„æ‰©å®¹å’Œç¼©å®¹ç­–ç•¥

### 3. å®‰å…¨æ€§
- **ç½‘ç»œç­–ç•¥**: é™åˆ¶Podé—´é€šä¿¡
- **RBAC**: åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶
- **Secretç®¡ç†**: æ•æ„Ÿä¿¡æ¯åŠ å¯†å­˜å‚¨
- **æœ€å°æƒé™åŸåˆ™**: åº”ç”¨åªè·å¾—å¿…è¦æƒé™

### 4. ç›‘æ§å’Œå¯è§‚æµ‹æ€§
- **Actuatorç«¯ç‚¹**: å¥åº·æ£€æŸ¥ã€æŒ‡æ ‡å’Œä¿¡æ¯ç«¯ç‚¹
- **Prometheusé›†æˆ**: è‡ªåŠ¨æœåŠ¡å‘ç°å’ŒæŒ‡æ ‡æ”¶é›†
- **æ—¥å¿—ç®¡ç†**: ç»“æ„åŒ–æ—¥å¿—è¾“å‡º
- **åˆ†å¸ƒå¼è¿½è¸ª**: æ”¯æŒé“¾è·¯è¿½è¸ª

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### æ–¹å¼ä¸€ï¼šä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x build-and-deploy.sh

# 2. æ‰§è¡Œéƒ¨ç½²
./build-and-deploy.sh deploy

# 3. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
./build-and-deploy.sh status
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. æ„å»ºåº”ç”¨
mvn clean package -DskipTests

# 2. æ„å»ºDockeré•œåƒ
docker build -t phonebook:latest .

# 3. éƒ¨ç½²åˆ°Kubernetes
kubectl apply -f k8s/

# 4. æ£€æŸ¥éƒ¨ç½²çŠ¶æ€
kubectl get all -n phonebook
```

## ğŸŒ è®¿é—®æ–¹å¼

### 1. NodePortè®¿é—®
```bash
# è·å–è®¿é—®åœ°å€
kubectl get service phonebook-nodeport -n phonebook
# è®¿é—®: http://<NODE_IP>:30080
```

### 2. Ingressè®¿é—®
```bash
# é…ç½®hostsæ–‡ä»¶
echo "<INGRESS_IP> phonebook.local" >> /etc/hosts
# è®¿é—®: http://phonebook.local
```

### 3. ç«¯å£è½¬å‘
```bash
kubectl port-forward service/phonebook-service 8080:80 -n phonebook
# è®¿é—®: http://localhost:8080
```

## ğŸ“Š ç›‘æ§ç«¯ç‚¹

| ç«¯ç‚¹ | æè¿° | URL |
|------|------|-----|
| å¥åº·æ£€æŸ¥ | åº”ç”¨å¥åº·çŠ¶æ€ | `/actuator/health` |
| åº”ç”¨ä¿¡æ¯ | åº”ç”¨åŸºæœ¬ä¿¡æ¯ | `/actuator/info` |
| æŒ‡æ ‡æ•°æ® | PrometheusæŒ‡æ ‡ | `/actuator/metrics` |
| ç¯å¢ƒä¿¡æ¯ | ç¯å¢ƒå˜é‡å’Œé…ç½® | `/actuator/env` |

## ğŸ”§ é…ç½®ç®¡ç†

### æ•°æ®åº“é…ç½®
- **ä¸»æœº**: 11.142.154.110
- **ç«¯å£**: 3306
- **æ•°æ®åº“**: fuaq8xj3
- **è¿æ¥æ± **: HikariCP (æœ€å¤§20ä¸ªè¿æ¥)

### èµ„æºé…ç½®
- **CPUè¯·æ±‚**: 250m
- **CPUé™åˆ¶**: 500m
- **å†…å­˜è¯·æ±‚**: 512Mi
- **å†…å­˜é™åˆ¶**: 1Gi

### æ‰©ç¼©å®¹é…ç½®
- **æœ€å°å‰¯æœ¬**: 2
- **æœ€å¤§å‰¯æœ¬**: 10
- **CPUé˜ˆå€¼**: 70%
- **å†…å­˜é˜ˆå€¼**: 80%

## ğŸ› ï¸ è¿ç»´æ“ä½œ

### æ‰©ç¼©å®¹
```bash
# æ‰‹åŠ¨æ‰©å®¹
kubectl scale deployment phonebook-app --replicas=5 -n phonebook

# æŸ¥çœ‹HPAçŠ¶æ€
kubectl get hpa -n phonebook
```

### æ›´æ–°éƒ¨ç½²
```bash
# æ›´æ–°é•œåƒ
kubectl set image deployment/phonebook-app phonebook=phonebook:v2.0.0 -n phonebook

# æŸ¥çœ‹æ›´æ–°çŠ¶æ€
kubectl rollout status deployment/phonebook-app -n phonebook
```

### æ—¥å¿—æŸ¥çœ‹
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
kubectl logs -f deployment/phonebook-app -n phonebook

# æŸ¥çœ‹ç‰¹å®šPodæ—¥å¿—
kubectl logs -f <pod-name> -n phonebook
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

1. **Podå¯åŠ¨å¤±è´¥**
   ```bash
   kubectl describe pod <pod-name> -n phonebook
   kubectl logs <pod-name> -n phonebook
   ```

2. **æ•°æ®åº“è¿æ¥é—®é¢˜**
   ```bash
   kubectl get secret phonebook-secret -n phonebook -o yaml
   ```

3. **æœåŠ¡è®¿é—®é—®é¢˜**
   ```bash
   kubectl get endpoints -n phonebook
   kubectl get ingress -n phonebook
   ```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### JVMè°ƒä¼˜
- ä½¿ç”¨G1åƒåœ¾æ”¶é›†å™¨
- åˆç†è®¾ç½®å †å†…å­˜å¤§å°
- å¯ç”¨JVMç›‘æ§å‚æ•°

### æ•°æ®åº“ä¼˜åŒ–
- è¿æ¥æ± å‚æ•°è°ƒä¼˜
- æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–
- ç´¢å¼•ä¼˜åŒ–

### Kubernetesä¼˜åŒ–
- èµ„æºè¯·æ±‚å’Œé™åˆ¶è°ƒä¼˜
- èŠ‚ç‚¹äº²å’Œæ€§é…ç½®
- å­˜å‚¨ä¼˜åŒ–

## ğŸ”’ å®‰å…¨æœ€ä½³å®è·µ

1. **ç½‘ç»œå®‰å…¨**
   - ä½¿ç”¨NetworkPolicyé™åˆ¶æµé‡
   - å¯ç”¨TLSåŠ å¯†
   - å®šæœŸæ›´æ–°é•œåƒ

2. **è®¿é—®æ§åˆ¶**
   - ä½¿ç”¨RBACç®¡ç†æƒé™
   - æœ€å°æƒé™åŸåˆ™
   - å®šæœŸå®¡è®¡æƒé™

3. **æ•°æ®å®‰å…¨**
   - æ•æ„Ÿä¿¡æ¯ä½¿ç”¨Secret
   - æ•°æ®åº“è¿æ¥åŠ å¯†
   - å®šæœŸå¤‡ä»½æ•°æ®

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [è¯¦ç»†éƒ¨ç½²æŒ‡å—](k8s-README.md)
- [Spring Bootæ–‡æ¡£](README.md)
- [Kuberneteså®˜æ–¹æ–‡æ¡£](https://kubernetes.io/docs/)

## ğŸ‰ éƒ¨ç½²æˆåŠŸéªŒè¯

éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯ç³»ç»Ÿæ­£å¸¸è¿è¡Œï¼š

1. **å¥åº·æ£€æŸ¥**: è®¿é—® `/actuator/health` ç«¯ç‚¹
2. **åŠŸèƒ½æµ‹è¯•**: è®¿é—®ä¸»é¡µé¢è¿›è¡ŒCRUDæ“ä½œ
3. **æ€§èƒ½æµ‹è¯•**: ä½¿ç”¨å‹åŠ›æµ‹è¯•å·¥å…·éªŒè¯æ€§èƒ½
4. **ç›‘æ§éªŒè¯**: æ£€æŸ¥PrometheusæŒ‡æ ‡æ”¶é›†

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜æˆ–éœ€è¦æŠ€æœ¯æ”¯æŒï¼Œè¯·å‚è€ƒï¼š
- è¯¦ç»†éƒ¨ç½²æ–‡æ¡£: `k8s-README.md`
- æ•…éšœæ’æŸ¥æŒ‡å—
- æ€§èƒ½è°ƒä¼˜å»ºè®®

---

**ğŸ¯ æ€»ç»“**: æœ¬Kuberneteséƒ¨ç½²æ–¹æ¡ˆæä¾›äº†å®Œæ•´çš„ä¼ä¸šçº§å®¹å™¨åŒ–è§£å†³æ–¹æ¡ˆï¼ŒåŒ…æ‹¬é«˜å¯ç”¨æ€§ã€è‡ªåŠ¨æ‰©ç¼©å®¹ã€ç›‘æ§å‘Šè­¦ã€å®‰å…¨é˜²æŠ¤ç­‰ç‰¹æ€§ï¼Œå¯ç›´æ¥ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚